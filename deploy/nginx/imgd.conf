server {
    listen 80;
    server_name img.example.com;

    sendfile on;
    tcp_nopush on;
    etag on;

    types {
        image/webp webp;
    }
    default_type application/octet-stream;

    open_file_cache max=10000 inactive=60s;
    open_file_cache_valid 120s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;

    location /images/ {
        alias /data/images/;
        autoindex off;

        add_header Cache-Control "public, max-age=31536000, immutable" always;
        expires 365d;

        limit_except GET HEAD { deny all; }
        try_files $uri =404;
    }

    location / {
        return 404;
    }
}
